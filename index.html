<!-- SAME FILE, FULL REPLACEMENT -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anonymous Messenger</title>

<link rel="manifest" href="manifest.json">

<style>
* { box-sizing: border-box; font-family: system-ui; }
body { margin: 0; background: #f0f2f5; height: 100vh; }

#contacts, #chat, #profile {
  height: 100vh; display: flex; flex-direction: column;
}

.header {
  background: #1877f2; color: white; padding: 14px;
  display: flex; align-items: center; justify-content: space-between;
}

.users, .messages {
  flex: 1; background: #fff; overflow-y: auto;
}

.user {
  padding: 12px; border-bottom: 1px solid #eee;
  display: flex; align-items: center; justify-content: space-between;
}

.avatar {
  width: 32px; height: 32px; border-radius: 50%;
  background: #ccc; margin-right: 10px; flex-shrink: 0;
}

.left { display: flex; align-items: center; gap: 8px; }

#profile input { margin: 10px; padding: 10px; }
button { padding: 6px 10px; }

.hidden { display: none; }
</style>
</head>

<body>

<!-- CONTACTS -->
<div id="contacts">
  <div class="header">
    <span>Contacts</span>
    <button onclick="openProfile()">ðŸ‘¤</button>
  </div>
  <div class="users" id="users"></div>
</div>

<!-- PROFILE -->
<div id="profile" class="hidden">
  <div class="header">
    <button onclick="closeProfile()">â¬…</button>
    <span>Your Profile</span>
  </div>
  <input id="usernameInput" placeholder="Username (optional)">
  <input type="file" accept="image/*" onchange="setAvatar(this)">
  <button onclick="saveProfile()">Save</button>
</div>

<!-- CHAT (same as before, trimmed for brevity) -->
<div id="chat" class="hidden"></div>

<script>
/* ===== Identity ===== */
const myId = localStorage.getItem("anon_identity")
  || (localStorage.setItem("anon_identity", crypto.randomUUID()), localStorage.getItem("anon_identity"));

/* ===== Profile ===== */
let profile = JSON.parse(localStorage.getItem("profile") || "{}");

function openProfile() {
  document.getElementById("contacts").classList.add("hidden");
  document.getElementById("profile").classList.remove("hidden");
  document.getElementById("usernameInput").value = profile.name || "";
}

function closeProfile() {
  document.getElementById("profile").classList.add("hidden");
  document.getElementById("contacts").classList.remove("hidden");
}

function setAvatar(input) {
  const file = input.files[0];
  const reader = new FileReader();
  reader.onload = () => profile.avatar = reader.result;
  reader.readAsDataURL(file);
}

function saveProfile() {
  profile.name = document.getElementById("usernameInput").value.trim();
  localStorage.setItem("profile", JSON.stringify(profile));
  closeProfile();
}

/* ===== Render example (placeholder) ===== */
document.getElementById("users").innerHTML = `
  <div class="user">
    <div class="left">
      <div class="avatar" style="background-image:url(${profile.avatar || ""})"></div>
      <span>${profile.name || "You"}</span>
    </div>
  </div>
`;
</script>

</body>
</html>
